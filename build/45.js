webpackJsonp([45],{1802:function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),t.d(o,"CoreCoursesMyCoursesPageModule",function(){return l});var r=t(0),s=t(3),n=t(2),i=t(1921),c=t(16),a=t(879),u=this&&this.__decorate||function(e,o,t,r){var s,n=arguments.length,i=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,r);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(i=(n<3?s(i):n>3?s(o,t,i):s(o,t))||i);return n>3&&i&&Object.defineProperty(o,t,i),i},l=function(){function e(){}return e=u([Object(r.I)({declarations:[i.a],imports:[c.a,a.a,s.l.forChild(i.a),n.b.forChild()]})],e)}()},1921:function(e,o,t){"use strict";t.d(o,"a",function(){return f});var r=t(0),s=t(3),n=t(12),i=t(4),c=t(9),a=t(42),u=t(21),l=t(112),d=this&&this.__decorate||function(e,o,t,r){var s,n=arguments.length,i=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,r);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(i=(n<3?s(i):n>3?s(o,t,i):s(o,t))||i);return n>3&&i&&Object.defineProperty(o,t,i),i},h=this&&this.__metadata||function(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)},f=function(){function e(e,o,t,r,s,n,i){this.navCtrl=e,this.coursesProvider=o,this.domUtils=t,this.eventsProvider=r,this.sitesProvider=s,this.courseHelper=n,this.courseOptionsDelegate=i,this.filter="",this.showFilter=!1,this.coursesLoaded=!1,this.prefetchCoursesData={},this.prefetchIconInitialized=!1,this.isDestroyed=!1}return e.prototype.ionViewDidLoad=function(){var e=this;this.searchEnabled=!this.coursesProvider.isSearchCoursesDisabledInSite(),this.downloadAllCoursesEnabled=!this.coursesProvider.isDownloadCoursesDisabledInSite(),this.fetchCourses().finally(function(){e.coursesLoaded=!0}),this.myCoursesObserver=this.eventsProvider.on(a.a.EVENT_MY_COURSES_UPDATED,function(){e.fetchCourses()},this.sitesProvider.getCurrentSiteId()),this.siteUpdatedObserver=this.eventsProvider.on(n.a.SITE_UPDATED,function(){var o=e.downloadAllCoursesEnabled;e.searchEnabled=!e.coursesProvider.isSearchCoursesDisabledInSite(),e.downloadAllCoursesEnabled=!e.coursesProvider.isDownloadCoursesDisabledInSite(),!o&&e.downloadAllCoursesEnabled&&e.coursesLoaded&&e.initPrefetchCoursesIcon()},this.sitesProvider.getCurrentSiteId())},e.prototype.fetchCourses=function(){var e=this;return this.coursesProvider.getUserCourses().then(function(o){var t=o.map(function(e){return e.id});return e.coursesProvider.getCoursesAdminAndNavOptions(t).then(function(t){o.forEach(function(e){e.navOptions=t.navOptions[e.id],e.admOptions=t.admOptions[e.id]}),e.courses=o,e.filteredCourses=e.courses,e.filter="",e.initPrefetchCoursesIcon()})}).catch(function(o){e.domUtils.showErrorModalDefault(o,"core.courses.errorloadcourses",!0)})},e.prototype.refreshCourses=function(e){var o=this,t=[];t.push(this.coursesProvider.invalidateUserCourses()),t.push(this.courseOptionsDelegate.clearAndInvalidateCoursesOptions()),Promise.all(t).finally(function(){o.prefetchIconInitialized=!1,o.fetchCourses().finally(function(){e.complete()})})},e.prototype.switchFilter=function(){this.filter="",this.showFilter=!this.showFilter,this.filteredCourses=this.courses},e.prototype.openSearch=function(){this.navCtrl.push("CoreCoursesSearchPage")},e.prototype.filterChanged=function(e){var o=e.target.value&&e.target.value.trim().toLowerCase();this.filteredCourses=o&&this.courses?this.courses.filter(function(e){return e.fullname.toLowerCase().indexOf(o)>-1}):this.courses},e.prototype.prefetchCourses=function(){var e=this,o=this.prefetchCoursesData.icon;return this.prefetchCoursesData.icon="spinner",this.prefetchCoursesData.badge="",this.courseHelper.confirmAndPrefetchCourses(this.courses,function(o){e.prefetchCoursesData.badge=o.count+" / "+o.total}).then(function(){e.prefetchCoursesData.icon="ion-android-refresh"}).catch(function(t){e.isDestroyed||(e.domUtils.showErrorModalDefault(t,"core.course.errordownloadingcourse",!0),e.prefetchCoursesData.icon=o)}).finally(function(){e.prefetchCoursesData.badge=""})},e.prototype.initPrefetchCoursesIcon=function(){var e=this;!this.prefetchIconInitialized&&this.downloadAllCoursesEnabled&&(this.prefetchIconInitialized=!0,!this.courses||this.courses.length<2?this.prefetchCoursesData.icon="":this.courseHelper.determineCoursesStatus(this.courses).then(function(o){var t=e.courseHelper.getCourseStatusIconAndTitleFromStatus(o).icon;"spinner"==t&&(t="cloud-download"),e.prefetchCoursesData.icon=t}))},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.myCoursesObserver&&this.myCoursesObserver.off(),this.siteUpdatedObserver&&this.siteUpdatedObserver.off()},e=d([Object(r.m)({selector:"page-core-courses-my-courses",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.courses.mycourses\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button *ngIf="searchEnabled" ion-button icon-only (click)="openSearch()" [attr.aria-label]="\'core.courses.searchcourses\' | translate">\n                <ion-icon name="search"></ion-icon>\n            </button>\n            <core-context-menu>\n                <core-context-menu-item [hidden]="!downloadAllCoursesEnabled || !courses || courses.length < 2" [priority]="800" [content]="\'core.courses.downloadcourses\' | translate" (action)="prefetchCourses()" [iconAction]="prefetchCoursesData.icon" [closeOnClick]="false" [badge]="prefetchCoursesData.badge"></core-context-menu-item>\n                <core-context-menu-item [hidden]="!courses || courses.length <= 5" [priority]="700" [content]="\'core.courses.filtermycourses\' | translate" (action)="switchFilter()" [iconAction]="\'funnel\'"></core-context-menu-item>\n            </core-context-menu>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <ion-refresher [enabled]="coursesLoaded" (ionRefresh)="refreshCourses($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="coursesLoaded">\n        <ion-searchbar *ngIf="showFilter" [(ngModel)]="filter" (ionInput)="filterChanged($event)" (ionCancel)="filterChanged()" [placeholder]="\'core.courses.filtermycourses\' | translate">\n        </ion-searchbar>\n        <ion-grid no-padding>\n            <ion-row no-padding>\n                <ion-col *ngFor="let course of filteredCourses" no-padding col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 align-self-stretch>\n                    <core-courses-course-progress [course]="course" class="core-courseoverview"></core-courses-course-progress>\n                </ion-col>\n            </ion-row>\n        </ion-grid>\n        <core-empty-box *ngIf="!courses || !courses.length" icon="ionic" [message]="\'core.courses.nocourses\' | translate">\n            <p *ngIf="searchEnabled">{{ \'core.courses.searchcoursesadvice\' | translate }}</p>\n        </core-empty-box>\n    </core-loading>\n</ion-content>\n'}),h("design:paramtypes",[s.q,a.a,c.a,n.a,i.a,u.a,l.a])],e)}()}});