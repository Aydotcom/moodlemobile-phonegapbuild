webpackJsonp([5],{1745:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AddonModAssignEditPageModule",function(){return l});var i=n(0),s=n(3),o=n(2),a=n(16),r=n(15),u=n(1839),d=n(1861),c=this&&this.__decorate||function(t,e,n,i){var s,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(o<3?s(a):o>3?s(e,n,a):s(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},l=function(){function t(){}return t=c([Object(i.I)({declarations:[d.a],imports:[a.a,r.a,u.a,s.l.forChild(d.a),o.b.forChild()]})],t)}()},1839:function(t,e,n){"use strict";n.d(e,"a",function(){return h});var i=n(0),s=n(17),o=n(3),a=n(2),r=n(16),u=n(15),d=n(75),c=n(43),l=n(877),f=n(878),g=n(881),m=n(1840),p=this&&this.__decorate||function(t,e,n,i){var s,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(o<3?s(a):o>3?s(e,n,a):s(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},h=function(){function t(){}return t=p([Object(i.I)({declarations:[l.a,f.a,g.a,m.a],imports:[s.b,o.k,a.b.forChild(),r.a,u.a,d.a,c.a],providers:[],exports:[l.a,f.a,g.a,m.a],entryComponents:[l.a]})],t)}()},1840:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var i=n(0),s=n(51),o=n(110),a=n(111),r=n(154),u=this&&this.__decorate||function(t,e,n,i){var s,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(o<3?s(a):o>3?s(e,n,a):s(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},d=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t,e,n,i){this.injector=t,this.feedbackDelegate=e,this.assignProvider=n,this.assignHelper=i,this.component=s.a.COMPONENT,this.text="",this.files=[]}return t.prototype.ngOnInit=function(){var t=this;this.plugin?(this.plugin.name=this.feedbackDelegate.getPluginName(this.plugin),this.plugin.name?(this.edit=this.edit&&"false"!==this.edit,this.canEdit=this.canEdit&&"false"!==this.canEdit,this.feedbackDelegate.getComponentForPlugin(this.injector,this.plugin).then(function(e){t.pluginComponent=e,e?t.data={assign:t.assign,submission:t.submission,plugin:t.plugin,userId:t.userId,configs:t.assignHelper.getPluginConfig(t.assign,"assignfeedback",t.plugin.type),edit:t.edit,canEdit:t.canEdit}:(t.text=t.assignProvider.getSubmissionPluginText(t.plugin),t.files=t.assignProvider.getSubmissionPluginAttachments(t.plugin),t.notSupported=t.feedbackDelegate.isPluginSupported(t.plugin.type),t.pluginLoaded=!0)})):this.pluginLoaded=!0):this.pluginLoaded=!0},t.prototype.invalidate=function(){return Promise.resolve(this.dynamicComponent&&this.dynamicComponent.callComponentFunction("invalidate",[]))},u([Object(i._9)(r.a),d("design:type",r.a)],t.prototype,"dynamicComponent",void 0),u([Object(i.D)(),d("design:type",Object)],t.prototype,"assign",void 0),u([Object(i.D)(),d("design:type",Object)],t.prototype,"submission",void 0),u([Object(i.D)(),d("design:type",Object)],t.prototype,"plugin",void 0),u([Object(i.D)(),d("design:type",Number)],t.prototype,"userId",void 0),u([Object(i.D)(),d("design:type",Object)],t.prototype,"canEdit",void 0),u([Object(i.D)(),d("design:type",Object)],t.prototype,"edit",void 0),t=u([Object(i.m)({selector:"addon-mod-assign-feedback-plugin",template:'\n<core-dynamic-component [component]="pluginComponent" [data]="data">\n    \x3c!-- This content will be replaced by the component if found. --\x3e\n    <core-loading [hideUntil]="pluginLoaded">\n        <ion-item text-wrap *ngIf="text.length > 0 || files.length > 0">\n            <h2>{{ plugin.name }}</h2>\n            <ion-badge *ngIf="notSupported" color="primary">\n                {{ \'addon.mod_assign.feedbacknotsupported\' | translate }}\n            </ion-badge>\n            <p *ngIf="text">\n                <core-format-text [component]="component" [componentId]="assign.cmid" [maxHeight]="80" [fullOnClick]="true" [fullTitle]="plugin.name" [text]="text"></core-format-text>\n            </p>\n            <core-file *ngFor="let file of files" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n        </ion-item>\n    </core-loading>\n</core-dynamic-component>\n'}),d("design:paramtypes",[i.C,a.a,s.a,o.a])],t)}()},1861:function(t,e,n){"use strict";n.d(e,"a",function(){return b});var i=n(0),s=n(3),o=n(2),a=n(12),r=n(4),u=n(52),d=n(9),c=n(103),l=n(51),f=n(78),g=n(242),m=n(110),p=this&&this.__decorate||function(t,e,n,i){var s,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(o<3?s(a):o>3?s(e,n,a):s(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},h=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(){function t(t,e,n,i,s,o,a,r,u,d,c,l){this.navCtrl=e,this.sitesProvider=n,this.syncProvider=i,this.domUtils=s,this.translate=o,this.fileUploaderHelper=a,this.eventsProvider=r,this.assignProvider=u,this.assignOfflineProvider=d,this.assignHelper=c,this.assignSyncProvider=l,this.saveOffline=!1,this.hasOffline=!1,this.isDestroyed=!1,this.forceLeave=!1,this.moduleId=t.get("moduleId"),this.courseId=t.get("courseId"),this.userId=n.getCurrentSiteUserId(),this.isBlind=!!t.get("blindId"),this.editText=o.instant("addon.mod_assign.editsubmission"),this.title=this.editText}return t.prototype.ngOnInit=function(){var t=this;this.fetchAssignment().finally(function(){t.loaded=!0})},t.prototype.ionViewCanLeave=function(){var t=this;return!!this.forceLeave||this.hasDataChanged().then(function(e){if(e)return t.domUtils.showConfirm(t.translate.instant("core.confirmcanceledit"))}).then(function(){t.assignHelper.clearSubmissionPluginTmpData(t.assign,t.userSubmission,t.getInputData())})},t.prototype.fetchAssignment=function(){var t=this,e=this.sitesProvider.getCurrentSiteUserId();return this.assignProvider.getAssignment(this.courseId,this.moduleId).then(function(e){return t.assign=e,t.title=e.name||t.title,t.isDestroyed||t.syncProvider.blockOperation(l.a.COMPONENT,e.id),t.assignSyncProvider.waitForSync(e.id)}).then(function(){return t.assignProvider.getSubmissionStatus(t.assign.id,t.userId,t.isBlind,!1,!0).catch(function(e){return t.assignProvider.getSubmissionStatus(t.assign.id,t.userId,t.isBlind).then(function(n){var i=t.assignProvider.getSubmissionObjectFromAttempt(t.assign,n.lastattempt);return t.assignHelper.canEditSubmissionOffline(t.assign,i).then(function(i){return i?n:(t.allowOffline=!1,Promise.reject(e))})})}).then(function(n){return n.lastattempt.canedit?(t.userSubmission=t.assignProvider.getSubmissionObjectFromAttempt(t.assign,n.lastattempt),t.allowOffline=!0,t.submissionStatement=t.assign.requiresubmissionstatement&&!t.assign.submissiondrafts&&t.userId==e?t.assign.submissionstatement:void 0,t.assignOfflineProvider.getSubmission(t.assign.id,t.userId).then(function(e){t.hasOffline=e&&e.pluginData&&Object.keys(e.pluginData).length>0}).catch(function(){t.hasOffline=!1})):Promise.reject(t.translate.instant("core.nopermissions",{$a:t.editText}))})}).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error getting assigment data."),t.leaveWithoutCheck()})},t.prototype.getInputData=function(){return this.domUtils.getDataFromForm(document.forms["addon-mod_assign-edit-form"])},t.prototype.hasDataChanged=function(){var t,e=this,n=!0;setTimeout(function(){n&&(t=e.domUtils.showModalLoading())},100);var i=this.getInputData();return this.assignHelper.hasSubmissionDataChanged(this.assign,this.userSubmission,i).finally(function(){t?t.dismiss():n=!1})},t.prototype.leaveWithoutCheck=function(){this.forceLeave=!0,this.navCtrl.pop()},t.prototype.prepareSubmissionData=function(t){var e=this;return this.saveOffline=this.hasOffline,this.assignHelper.prepareSubmissionPluginData(this.assign,this.userSubmission,t,this.hasOffline).catch(function(n){return e.allowOffline&&!e.saveOffline?(e.saveOffline=!0,e.assignHelper.prepareSubmissionPluginData(e.assign,e.userSubmission,t,!0)):Promise.reject(n)})},t.prototype.save=function(){var t=this;this.hasDataChanged().then(function(e){e?t.saveSubmission().then(function(){t.leaveWithoutCheck()}).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error saving submission.")}):t.leaveWithoutCheck()})},t.prototype.saveSubmission=function(){var t=this,e=this.getInputData();if(this.submissionStatement&&(!e.submissionstatement||"false"===e.submissionstatement))return Promise.reject(this.translate.instant("addon.mod_assign.acceptsubmissionstatement"));var n=this.domUtils.showModalLoading();return this.assignHelper.getSubmissionSizeForEdit(this.assign,this.userSubmission,e).catch(function(){return-1}).then(function(e){return n.dismiss(),t.fileUploaderHelper.confirmUploadFile(e,!0,t.allowOffline)}).then(function(){return n=t.domUtils.showModalLoading("core.sending",!0),t.prepareSubmissionData(e).then(function(e){if(Object.keys(e).length){return(t.saveOffline?t.assignOfflineProvider.saveSubmission(t.assign.id,t.courseId,e,t.userSubmission.timemodified,!t.assign.submissiondrafts,t.userId):t.assignProvider.saveSubmission(t.assign.id,t.courseId,e,t.allowOffline,t.userSubmission.timemodified,t.assign.submissiondrafts,t.userId)).then(function(){var e={assignmentId:t.assign.id,submissionId:t.userSubmission.id,userId:t.userId};t.eventsProvider.trigger(l.a.SUBMISSION_SAVED_EVENT,e,t.sitesProvider.getCurrentSiteId()),t.assign.submissiondrafts||t.eventsProvider.trigger(l.a.SUBMITTED_FOR_GRADING_EVENT,e,t.sitesProvider.getCurrentSiteId())})}})}).finally(function(){n.dismiss()})},t.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.assign&&this.syncProvider.unblockOperation(l.a.COMPONENT,this.assign.id)},t=p([Object(i.m)({selector:"page-addon-mod-assign-edit",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n\n        <ion-buttons end>\n            <button ion-button clear (click)="save()" [attr.aria-label]="\'core.save\' | translate">\n                {{ \'core.save\' | translate }}\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <core-loading [hideUntil]="loaded">\n        <ion-list>\n            \x3c!-- @todo: plagiarism_print_disclosure --\x3e\n            <form name="addon-mod_assign-edit-form" *ngIf="userSubmission && userSubmission.plugins && userSubmission.plugins.length">\n                \x3c!-- Submission statement. --\x3e\n                <ion-item text-wrap *ngIf="submissionStatement">\n                    <ion-label><core-format-text [text]="submissionStatement"></core-format-text></ion-label>\n                    <ion-checkbox item-end name="submissionstatement" [(ngModel)]="submissionStatementAccepted"></ion-checkbox>\n\n                    \x3c!-- ion-checkbox doesn\'t use an input. Create a hidden input to hold the value. --\x3e\n                    <input item-content type="hidden" [ngModel]="submissionStatementAccepted" name="submissionstatement">\n                </ion-item>\n\n                <addon-mod-assign-submission-plugin *ngFor="let plugin of userSubmission.plugins" [assign]="assign" [submission]="userSubmission" [plugin]="plugin" [edit]="true" [allowOffline]="allowOffline"></addon-mod-assign-submission-plugin>\n            </form>\n        </ion-list>\n    </core-loading>\n</ion-content>\n'}),h("design:paramtypes",[s.r,s.q,r.a,u.a,d.a,o.c,c.a,a.a,l.a,f.a,m.a,g.a])],t)}()}});