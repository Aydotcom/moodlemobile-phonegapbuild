webpackJsonp([28],{1819:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CoreLoginSitePageModule",function(){return c});var i=n(0),o=n(3),r=n(1938),s=n(2),l=n(15),a=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},c=function(){function e(){}return e=a([Object(i.I)({declarations:[r.a],imports:[l.a,o.l.forChild(r.a),s.b.forChild()]})],e)}()},1938:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(0),o=n(3),r=n(11),s=n(4),l=n(9),a=n(68),c=n(76),d=n(19),f=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,i,o,r,s){this.navCtrl=e,this.appProvider=n,this.sitesProvider=i,this.loginHelper=o,this.modalCtrl=r,this.domUtils=s,this.displayAsButtons=!1;var l="";this.loginHelper.hasSeveralFixedSites()&&(this.fixedSites=this.loginHelper.getFixedSites(),this.displayAsButtons="buttons"==a.a.multisitesdisplay,l=this.fixedSites[0].url),this.siteForm=t.group({siteUrl:[l,d.h.required]})}return e.prototype.connect=function(e){var t=this;if(this.appProvider.closeKeyboard(),e)if(this.appProvider.isOnline()){var n=this.domUtils.showModalLoading(),i=this.sitesProvider.getDemoSiteData(e);i?this.sitesProvider.getUserToken(i.url,i.username,i.password).then(function(e){return t.sitesProvider.newSite(e.siteUrl,e.token,e.privateToken).then(function(){return t.loginHelper.goToSiteInitialPage()},function(e){t.domUtils.showErrorModal(e)})},function(e){t.loginHelper.treatUserTokenError(i.url,e)}).finally(function(){n.dismiss()}):this.sitesProvider.checkSite(e).then(function(e){e.warning&&t.domUtils.showErrorModal(e.warning,!0,4e3),t.loginHelper.isSSOLoginNeeded(e.code)?t.loginHelper.confirmAndOpenBrowserForSSOLogin(e.siteUrl,e.code,e.service,e.config&&e.config.launchurl):t.navCtrl.push("CoreLoginCredentialsPage",{siteUrl:e.siteUrl,siteConfig:e.config})},function(n){t.showLoginIssue(e,n)}).finally(function(){n.dismiss()})}else this.domUtils.showErrorModal("core.networkerrormsg",!0);else this.domUtils.showErrorModal("core.login.siteurlrequired",!0)},e.prototype.showHelp=function(){this.modalCtrl.create("CoreLoginSiteHelpPage").present()},e.prototype.showLoginIssue=function(e,t){this.modalCtrl.create("CoreLoginSiteErrorPage",{siteUrl:e,issue:t}).present()},e=f([Object(i.m)({selector:"page-core-login-site",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.login.connecttomoodle\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button ion-button icon-only (click)="showHelp()" [attr.aria-label]="\'core.help\' | translate">\n                <ion-icon name="help-circle"></ion-icon>\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content class="core-center-view">\n    <div class="box">\n        <div text-center padding>\n            <img src="assets/img/login_logo.png" class="avatar-full login-logo" role="presentation">\n        </div>\n        <form ion-list no-lines [formGroup]="siteForm" (ngSubmit)="connect(siteForm.value.siteUrl)">\n            \x3c!-- Form to input the site URL if there are no fixed sites. --\x3e\n            <div *ngIf="!fixedSites">\n                <p padding>{{ \'core.login.newsitedescription\' | translate }}</p>\n                <ion-item>\n                    <ion-input type="url" name="url" placeholder="{{ \'core.login.siteaddress\' | translate }}" formControlName="siteUrl" [core-auto-focus]></ion-input>\n                </ion-item>\n            </div>\n\n            \x3c!-- Pick the site from a list of fixed sites. --\x3e\n            <div *ngIf="fixedSites" text-wrap>\n                \x3c!-- Display them using a select. --\x3e\n                <ion-item *ngIf="!displayAsButtons">\n                    \x3c!-- @todo: Display label and select in different lines. --\x3e\n                    <ion-label for="siteSelect">{{ \'core.login.selectsite\' | translate }}</ion-label>\n                    <ion-select formControlName="siteUrl" name="url" placeholder="{{ \'core.login.siteaddress\' | translate }}" interface="popover">\n                        <ion-option *ngFor="let site of fixedSites" [value]="site.url">{{site.name}}</ion-option>\n                    </ion-select>\n                </ion-item>\n\n                \x3c!-- Display them using buttons. --\x3e\n                <div *ngIf="displayAsButtons">\n                    <p class="padding no-padding-bottom">{{ \'core.login.selectsite\' | translate }}</p>\n                    <a *ngFor="let site of fixedSites" ion-button block (click)="connect(site.url)" title="{{site.name}}">{{site.name}}</a>\n                </div>\n            </div>\n\n            <button *ngIf="!fixedSites || !displayAsButtons" ion-button block [disabled]="!siteForm.valid">{{ \'core.login.connect\' | translate }}</button>\n        </form>\n    </div>\n</ion-content>\n'}),u("design:paramtypes",[o.q,d.a,r.a,s.a,c.a,o.o,l.a])],e)}()}});